# SniShaper

SniShaper 是一个桌面代理工具，面向 DPI 场景下的分流与访问问题。它提供可视化界面，用规则把不同站点流量导向不同处理模式。

- `transparent`：透明透传（TCP 隧道）
- `mitm`：中间人模式（本地 CA 解密 + 上游 SNI 控制）

核心目标：让你在不改浏览器复杂参数的情况下，通过 GUI 管理规则、系统代理和证书。

## 原理简介

SniShaper 工作在本机代理位置。浏览器流量进入本机后，按域名规则进行处理：

1. `transparent`：不解密 TLS，直接隧道转发。  
2. `mitm`：浏览器与本机代理建立 TLS，本机代理再与上游建立 TLS，可按规则控制上游 SNI。  

## 两种模式说明

### transparent 模式

- 不需要安装 CA 证书。
- 适合已知可透传的链路。
- 稳定、简单、开销小。

### mitm 模式

- 需要安装并信任当前 CA 证书。
- 适合需要上游 SNI 控制的场景。
- 能力更强，但配置要求更高。

## 快速使用

### 1. 启动程序

- 打开应用，确认监听地址（默认 `127.0.0.1:8080`）。

### 2. 选择模式

- 如果你只需要先跑通链路：先用 `transparent`。
- 需要 SNI 控制时：切到 `mitm`。

### 3. 配置规则

在规则页添加或编辑规则：

- `domains`：要匹配的域名列表
- `mode`：`transparent` 或 `mitm`
- `upstream`：上游地址（域名或 IP:端口）
- `sni_fake`：MITM 场景下的上游 SNI（可选）

### 4. 启动代理

- 点击“启动代理”
- 点击“系统代理：开”（让系统流量进入本机代理）

### 5. 验证

- 浏览器访问目标站点
- 根据实际连通性调整规则和上游地址

## 证书安装（MITM 必需）

1. 在设置页导出或打开当前 CA 证书  
2. 安装到受信任根证书位置  
3. 重启浏览器再测试  

说明：如果你重新生成过 CA，需要重新安装新证书。

## 目录说明（用户关注）

- `config.json`：规则与上游配置（与可执行文件同目录）
- `cert/`：CA 与证书文件目录
- `snishaper.log`：运行日志（用于排查）

## 免责声明

本项目仅用于网络技术研究与授权测试，请在符合法律法规和服务条款的前提下使用。
